{% extends "base.html" %}

{% block content %}
<div class="glass-panel">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Attempt Details: {{ user.username }}</h2>
        <a href="{{ url_for('quiz.quiz_summary', quiz_id=quiz.id) }}" class="btn btn-palette-secondary">Back</a>
    </div>

    <div class="alert alert-info py-2">
        <div class="d-flex justify-content-between align-items-center">
            <span><strong>Quiz:</strong> {{ quiz.title }} | <strong>Total XP:</strong> <span class="xp-badge ms-2"
                    style="font-size: 0.85em;">{{ score.xp_earned }} XP</span></span>
            {% if viewer.role == 'admin' %}
            <span class="badge badge-role-mod">Admin View Enabled</span>
            {% endif %}
        </div>
    </div>

    {% if viewer.role == 'admin' and score_data and score_data.xp_breakdown %}
    <div class="glass-panel mb-4 shadow-sm">
        <div class="card-body">
            <h5 class="card-title text-palette-primary"><i class="bi bi-calculation"></i> Admin Only: XP Calculation
                Breakdown
            </h5>
            <hr class="border-secondary">
            <div class="row text-center">
                <div class="col-md-4">
                    <div class="small text-muted">Base XP</div>
                    <div class="h4 mb-0">+{{ score_data.xp_breakdown.base }}</div>
                    <small class="text-secondary">(Correct Count × 10)</small>
                </div>
                <div class="col-md-4 border-start border-secondary">
                    <div class="small text-muted">Streak Bonus</div>
                    <div class="h4 mb-0">+{{ score_data.xp_breakdown.streak }}</div>
                    <small class="text-secondary">(Max Streak × 5)</small>
                </div>
                <div class="col-md-4 border-start border-secondary">
                    <div class="small text-muted">Difficulty Bonus</div>
                    <div class="h4 mb-0">+{{ score_data.xp_breakdown.diff }}</div>
                    <small class="text-secondary">(Sum of Question Diff)</small>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="card p-3">
        {% for q in details %}
        <div class="mb-3 border-bottom pb-3">
            <h5 class="mb-2">Q{{ loop.index }}: {{ q.text }} <span class="badge bg-secondary">Diff: {{ q.difficulty
                    }}</span></h5>
            <div class="ms-3">
                {% for opt in q.options %}
                <div class="form-check">
                    <input class="form-check-input" type="radio" disabled {% if loop.index0==q.user_choice %}checked{%
                        endif %}>

                    <label class="form-check-label 
                        {% if loop.index0 == q.correct_option %}text-palette-success fw-bold{% endif %}
                        {% if loop.index0 == q.user_choice and not q.is_correct %}text-palette-danger fw-bold{% endif %}
                    ">
                        {{ opt }}
                        {% if loop.index0 == q.correct_option %}✅ (Correct){% endif %}
                        {% if loop.index0 == q.user_choice and not q.is_correct %}❌ (User's Choice){% endif %}
                    </label>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}